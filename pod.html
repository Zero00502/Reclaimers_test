<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pod Information</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" integrity="sha384-DyZvLhM3rZFl+VmM0Nps92lEYeQV7HRpX2GlBlE2MDFKGeDsqFDu3scde0cCpV6x" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="./stylesheets/style.css" />
    <link rel="stylesheet" type="text/css" href="./stylesheets/podStyle.css" />
</head>
<body>
    <header class="bg-secondary text-black py-3 d-flex justify-content-between align-items-center">
        <i id="sidebarOpen" class="fa-solid fa-bars fa-3x ml-104"></i>
        <h1 class="m-0 mx-auto">TheReclaimers</h1>
        <i class="far fa-user fa-3x ms-auto mr-5"></i>
    </header>

    <div class="sidebar shadow" id="sidebarMenu">
        <div class="sidebar-header py-3 bg-secondary">
            <i id="sidebarClose" class="fa-solid fa-bars fa-3x text-black"></i>
        </div>
        <a href="./index.html" class="sidebar-item">
            <i class="fa-solid fa-house"></i>
            <span>Home</span>
        </a>
        <a href="#" class="sidebar-item">
            <i class="fa-solid fa-chart-line"></i>
            <span>Analytics</span>
        </a>
        <a href="#" class="sidebar-item">
            <i class="fa-solid fa-wave-square"></i>
            <span>Predictions</span>
        </a>
        <a href="./pods.html" class="sidebar-item active">
            <i class="fa-solid fa-circle-info"></i>
            <span>Pod Information</span>
        </a>
    </div>

    <div class="container">
        <div class="row mt-5">
            <!-- Search Bar -->
            <div class="search-bar text-center d-flex align-items-center">
                <input type="text" class="form-control d-inline-block w-75" placeholder="Enter the device" aria-label="Device Search">
                <button class="btn btn-dark">Search</button>
            </div>

            <!-- Table Container with scrollable content -->
            <div class="container table-container">
                <table class="table table-bordered">
                    <thead class="thead-light">
                        <tr>
                            <th>id</th>
                            <th>name</th>
                            <th>condition</th>
                            <th>status</th>
                            <th>battery</th>
                            <th>last day checked</th>
                        </tr>
                    </thead>
                    <tbody id="pod-data">

                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal for displaying Pod details -->
    <div class="modal fade" id="podModal" tabindex="-1" aria-labelledby="podModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="podModalLabel">Pod Information</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <p><strong>ID:</strong> <span id="modal-pod-id"></span></p>
                    <p><strong>Name:</strong> <span id="modal-pod-name"></span></p>
                    <p><strong>Condition:</strong> <span id="modal-pod-condition"></span></p>
                    <p><strong>Status:</strong> <span id="modal-pod-status"></span></p>
                    <p><strong>Battery:</strong> <span id="modal-pod-battery"></span></p>
                    <p><strong>Last Checked:</strong> <span id="modal-pod-lastChecked"></span></p>
                    <p><strong>pH Value:</strong> <span id="modal-pod-ph"></span></p>
                    <p><strong>Temperature:</strong> <span id="modal-pod-temperature"></span></p>
                    <p><strong>GPS Location:</strong> <span id="modal-pod-gps"></span></p>
                    <p><strong>Solids Value:</strong> <span id="modal-pod-solids"></span></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <footer class="bg-dark text-white text-center py-3 mt-5 fixed-bottom">
        <p>&copy; 2024 Your Company Name. All Rights Reserved.</p>
    </footer>

    <script src="https://kit.fontawesome.com/6a12ba73c1.js" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        $(document).ready(function() {
            // Sidebar toggle functionality
            $('#sidebarOpen').click(function() {
                $('#sidebarMenu').toggleClass('show');
                $('body').toggleClass('blur');
            });
    
            $('#sidebarClose').click(function() {
                $('#sidebarMenu').toggleClass('show');
                $('body').toggleClass('blur');
            });
    
            // Fetch data on page load
            window.onload = fetchData;
        });
    
        // Function to fetch and display the data
        async function fetchData() {
            try {
                const response = await fetch('/pod'); 
                const data = await response.json();   
                displayData(data);                    
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }
    
        // Function to render the data in the HTML table
        function displayData(data) {

            const podDataDiv = document.getElementById('pod-data');
            podDataDiv.innerHTML = ''; 
    
            data.forEach(item => {
                const itemDiv = document.createElement('tr');
                itemDiv.classList.add('pod-item');
                itemDiv.setAttribute('data-id', item.ID); 
                itemDiv.innerHTML = `
                    <td id="pod-id">${item.ID}</td>
                    <td>${item.Name}</td>
                    <td>${item.condition}</td>
                    <td>${item.status}</td>
                    <td>${item.battery}</td>
                    <td>${item.lastDayChecked}</td>
                `;
    
                // Make the row clickable
                itemDiv.addEventListener('click', function() {
                    const podID = itemDiv.getAttribute('data-id'); 

                    // Fetch additional data for the specific Pod ID
                    fetch(`/podsensordata?id=${podID}`)
                        .then(response => response.json())
                        .then(data => {
                            const podData = data[0]; 
                            
                            // Populate the modal with the fetched pod data
                            $('#modal-pod-id').text(podData.id);
                            $('#modal-pod-name').text(podData.Name);
                            $('#modal-pod-condition').text(podData.condition);
                            $('#modal-pod-status').text(podData.status);
                            $('#modal-pod-battery').text(podData.battery);
                            $('#modal-pod-lastChecked').text(podData.lastDayChecked);
                            $('#modal-pod-ph').text(podData.ph_value);
                            $('#modal-pod-temperature').text(podData.temperature_value);
                            $('#modal-pod-gps').text(`Latitude: ${podData.latitude}, Longitude: ${podData.longitude}`);
                            $('#modal-pod-solids').text(podData.solids_value);
    
                            // Show the modal
                            $('#podModal').modal('show');
                        })
                        .catch(error => {
                            console.error('Error fetching pod data:', error);
                        });
                });
    
                podDataDiv.appendChild(itemDiv);
            });
        }
    </script>    
</body>
</html>


